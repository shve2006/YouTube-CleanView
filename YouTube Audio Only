// ==UserScript==
// @name         YouTube Audio-Only Mode
// @namespace    http://tampermonkey.net/
// @version      1.2
// @description  Play YouTube videos in audio-only mode to save bandwidth.
// @author       You
// @match        https://www.youtube.com/watch*
// @grant        none
// @run-at       document-idle
// ==/UserScript==

(function () {
    'use strict';

    // Wait for YouTube's player to load
    const waitForPlayer = () => {
        const player = document.getElementById('movie_player');
        if (player && typeof player.getVideoData === 'function') {
            enableAudioOnly();
        } else {
            setTimeout(waitForPlayer, 500);
        }
    };

    const enableAudioOnly = () => {
        console.log('[YT Audio-Only] Activating audio-only mode...');

        // Attempt 1: Use YouTube's internal API to set playback quality to audio-only
        // Note: This may not always work due to YouTube updates
        try {
            const player = document.getElementById('movie_player');
            if (player && player.setPlaybackQualityRange) {
                // Force lowest quality (often audio-only in background)
                player.setPlaybackQualityRange('tiny', 'tiny');
                player.setPlaybackQuality('tiny');
            }
        } catch (e) {
            console.warn('[YT Audio-Only] Failed to set quality via API:', e);
        }

        // Attempt 2: Hide video element (UX only ‚Äì doesn't stop download!)
        const videoElement = document.querySelector('video');
        if (videoElement) {
            // Mute video visually (optional)
            videoElement.style.display = 'none';
            // Optional: Add a placeholder
            const placeholder = document.createElement('div');
            placeholder.innerText = 'üîä Audio Only';
            placeholder.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 24px;
                z-index: 1000;
                pointer-events: none;
            `;
            const playerContainer = document.querySelector('.html5-video-player') || document.getElementById('player');
            if (playerContainer) {
                playerContainer.style.backgroundColor = '#000';
                playerContainer.appendChild(placeholder);
            }
        }

        // ‚ö†Ô∏è IMPORTANT: This does NOT prevent video segments from downloading!
        // To truly avoid video download, we need to intercept network requests (see below).
    };

    // Start the process
    waitForPlayer();
})();
